---
title: 读书笔记- CleanCode
date: 2019-04-25 11:10:10
categories: 读书笔记
tags: [阅读]
---

CleanCode 阅读

<!-- more -->

> Clean code

### CleanCode

欢迎大家今天来听本次阅读分享，关于代码整洁之道这个书的一些个人的心得体会，今天把这个阶段的阅读体验给大家分享一下

#### 第一章节

首先第一章节，我们为什么要求整洁的代码风格

想一下，我们去看一些第三方的库或者项目的时候，是不是更加喜欢那种风格统一，代码整洁，可以说一目了然的那种项目， 比如说咱们大家一般都看过koa的源码，他的四个核心方法库，里面的代码就是让人感觉很清晰，很舒服

那这个就是第一点， 代码是人开发的，而其阅读者也是开发者，虽然他最后真正到执行是机器。从一行代码诞生开始到最后被运行，中间要面临可能是多个人的参与。

* point 2

比如后台hp这个项目，从项目初期搭建，到现在这种让人不忍直视的场面，其中参与的人可能有 10个吧，那么这些参与者对这个项目有什么样的体验呢？

【这里可以请后台小组成员回答一下，初次接触的感受。

那对于我个人来说，初次接触这个项目的场景是什么样的，首先是根据readme没有把项目启动，然后第一个任务是去修改，或者是去增加一个小功能，那我去看这个的开发的代码，就发现一些问题，比如 某些接口，他的不同的路由接口，使用的是同一个方法函数。还有一些方法的拆分封装不合理，无法很好的重用。 等等】

这就是要说的第二点，别人可以理解我们写下的代码吗

每一个项目中必须有的readme文档，帮助每一个新手去知道项目整体架构，如何部署等等。 而我们如果真正的要去投入开发，这个时候就要去分析实现细节，越混乱的代码就越阻碍开发者的效率

* point 3

其实类似于后台的这种项目，他们属于长期业务，需要人力的长期开发维护，我们的运营活动也是，项目的生命周期都比较长，期间可能会经历多次项目迭代

这个就是第三点，对于这种需要长期维护的项目，保持代码的整洁是非常有必要的。如果代码太混乱，梳理逻辑要耗费大量时间的话，维护人员可能会决定先停止开发进程，优先重构。

##### page2

快速掌握

如果说文档可以帮助团队成员迅速熟悉业务，那么整洁代码是用来帮助我们更加详细的理解逻辑的具体实现 

可维护性

因为我们经常会遇到的问题是，需要去处理历史遗留的bug，你需要去翻别的人代码细节，整洁的代码让我们快速理解实现，在做项目的维护工作就非常方便了

用后台来举例子，比如是某些列表的数据信息出错，那我们基本可以确定的是一个 get 的函数有问题， 那就可以继续查看是数据库问题还是数据处理有误

保持整洁有序的代码风格，可以帮助我们快速了解项目，定位问题

##### page3

我们简单总结下这些令人感觉很舒服项目的共同点，比如说 保持函数功能单一，代码非常具有表现力，不会出现重复的逻辑等等

我们在Git去看那些优秀的库，比如 ant-design。可以用咱们的项目去做一个对比，比如说用后台的，在直观体验上就有很大区别

比如后台广告平台的开发，他的form表单 是一个 大概2000+行的组件，第一眼的印象就是代码量大，拆分不合理，不好管理，里面逻辑比较混乱。对于新上手的开发者，要分析清楚这里的逻辑很需要一段时间

【 这里把广告的那个代码打开做对比 】

可以对比下，我们的组件具有这个特点吗，代码表现力怎么样，保持了函数的单一性吗

这个就是为什么我们要遵守或者说去追求整洁的代码风格，就是时刻让代码保持舒适感，给使用者最好的代码开发体验

#### 第二章节

刚刚说了很多关于为什么要保持整洁的代码风格，现在我们去看一下，在项目开发中，怎么注意去写出舒适到代码

整体来说就这两点， 1 现在就做  2 小技巧

对于项目开发者，有的时候比较优先考虑的是项目的进度周期，所以在开发的时候，会无意间写一些比较凌乱的代码，想着以后再去修改调整，但是基本上就是，明日复明日，明日何其多了。很大概率是不会再去调整了，所以我们应该尽量在开发的时候就保持这种整洁的代码风格，不要推到以后

第二点遵守各种小技巧，他们是代码整洁的关键，可能代码量少的时候感受不出来，不过积少成多，项目周期久了之后，就能体会到了，他们不是短期收益，属于长期才能看到效果和优点

##### page2

咱们来具体聊一聊，有哪些可以保持整洁风格的代码技巧

* 命名

变量的命名体现了代码的表现力，通过清晰的命名，展示本身的功能。

比如，对于我们而言，有的时候不需要了解代码的具体实现细节，只需要明白如何使用就好，比如项目中的各种工具函数，基本根据名字就可以判断作用

那关于命名的一些注意点

[提问： 你的命名风格。 比如，个人信息，全部用户信息列表，团队信息列表 

Xx的回答中也比较符合整洁之道的建议]

1.1 尽量具有描述意义的名称，遵循一般规律，比如类名大多是名词，方法大多是动词开头，例如获取 get  变更 update 等等

1.2 要名副其实的名称，比如用户列表，要用userList， 不是 listData 

1.3 要做有意义的区分， 比如 不要同时出现，user， userdata, userinfo 这三个看上去其实并没有什么区别
1.4 使用可读的变量名称  有人将单词的首字母拼接在一起，那基本除了作者之外就没人读懂

1.5 不添加不必要的上下文  比如 book 对象有一个 color 属性 那不要写为 book.bookColor 
 
##### page3

关于函数，来说以下几点

* 保持函数短小 

函数第一规则是短小，短小的函数有利用拆分复用，维护起来也相对简单

[提问： 你如何拆分函数。 比如有一个列表展示的接口   ]

一般函数拆分可以按照两种维度来做

横向 — 同类型处理，比如对于表的操作，对于数据的操作，拆分到不同方法中

纵向 — 按照业务流程，从接口的参数处理 ，到查询数据库，返回结果

刚好昨天晚上有看到一篇文章实在讨论函数保持多少行是合理的，这里发给大家看下。   多长的函数才合理  https://mp.weixin.qq.com/s/sEVG6z0A8MeltVPlGLu6JA  有人在讨论 10 -15行 

其实我感觉这个要看具体的开发场景，没有特定的规范。不过要尽量拆分，保持函数简练，便于管理维护

##### page4

* 函数单一职责

   其实函数单一性是经常听到的一句话， 是整洁代码的最重要也是最基本的原则

[提问 - 为什么]

* 便于管理  -这个就和上面的 要求函数短小一样了，函数功能越单一，管理越简单

* 有利于方法的复用 .  如果方法干了两件事情，那么其他业务如果对于其中一个的使用有差别，这个函数就不好重用了

比如 后台hk中， 写的一个 返回 header的方法， 里面有 request_id  生成的随机数，那我的需求只是需要这个随机的  request_id 

所以这个方法就不能重用了


那我们如何去判断函数是否保持了单一性，基本上可以参考这两点去判断

1 这个函数能不能用一句话去解释

找一个例子，Ad form 组件的  checkImg 方法, 里面的 获取 array 可以被单独提取出来的

2 主观判断一下这个函数有没有可被拆分的必要，如果认为他还可以被拆分，那么可能就是没有实现单一性

* 函数参数 

参数是函数的输入，一般是按照重要性进行排序

参数设置应该要考虑多个方面，比如你的代码复用性如何，太多参数是不是影响开发体验等

这里简单举个比较常见的例子

1 参数是布尔值

表示这个函数肯定不止做一件事，违反了单一原则，所以最好直接拆分两个函数，doForTrue , doForFalse

2 参数超过3个

推荐构建 参数 object  — 过长的参数不易管理

3 有参vs无参

比如我们写的sleep函数，其中的时间是传参还是直接写到函数里面。这个要按照实际情况处理，没有具体的规律


所以在设置函数参数的地方，要注意从保持代码整洁的方面考虑

*函数副作用

如果一个函数做了除接受一个值然后返回一个值或多个值之外的任何事情， 它将会可能就会产生副作用

举例说明，之前运营活动中有一个文件上传的功能，他的副作用就是，会在磁盘中创建一个临时文件。但是我们没有办法取消这个副作用， 需要做的是集中处理这个上传工作，  用一个服务来实现它， 上传然后完成删除

* 函数命名

关于命名，上面已经提到了一部分，这里针对于函数的命名再说一句，函数越短小，功能越单一，那么更容易起一个好名字

* 不要写重复的逻辑

注重代码的拆分封装，不要做重复的事情。 其实去看项目，大部分由于重复的处理类似的逻辑变得庞大不好管理

##### page5

* 移除僵尸代码

这种情况在比较久的项目中会有一些，就是被注释了但是没有被删除的代码。
那你可能不确定为什么添加注释的人没有删除，是不是会有什么用。不要犹豫，直接删除

不要害怕删除僵尸代码，工具会帮你记得它 【gitlib】

*  异常

把一段代码用 try/catch 包裹起来  意味着你想到这里可能会出错。 尽量不要写 console.log 而应该
放到合适的位置

路由会有这个错误，有的时候会直接写 cosnole.log(e) 

##### page6

* 注释

其实注释是每一个项目的必然存在的，比如对于方法，某些变量，以及条件处理语句的注释，那我们可能要考虑的是，在项目我们写的这些注释是合理的吗

[首先我们来想一下，什么场景下会去写注释]

表达的意图是失败
- 从代码上看不懂想要做什么，换句话说，此时你的代码表达的意图是失败的，此时需要配合一段注释去解释说明代码的含义

看反例，  这里的从代码中根本看不出来要这么写的原因，没有办法用代码去表达意图，所以加了很多注释，不然一个月之后就不知道为什么这么处理了，对之后的维护工作带来很大困扰

我们看koa，一般出现注释的会是在什么地方。 函数方法，标明其 输入输出即可，这种注释就非常简洁。

不推荐在代码中使用大量的注释
我们不推荐在代码中使用大量的注释 ，为什么？—  因为在维护代码的过程中，可能不会去维护注释，这样时间久了之后注释可能与代码的逻辑脱节，造成困扰。 

* 适合添加注释的场景 

函数方法，注释参数，返回值

我们尽量只在必要的地方添加注释，不要过度依赖注释，因为只有代码是真实的。

* 开发风格
这个就取决于团队的习惯了，比如保持代码缩进，命名使用驼峰还是下划线，代码之间的隔离如何处理等等

格式化就像其它规则一样， 没有必须让你遵守的硬性规则。 重点是不要因为格式去争论。基本可以借助 eslint 工具来处理 

##### page7

—实例展示—

广告组件的问题

1 代码量大，阅读体验不好 — 意味着拆分不合理

2 违反的单一原则，做了多件事情

3 发现多个switch语句，这个是导致代码量巨大的主要原因

4 命名 - 名不副实  uploadFileTip 其实是 showFileTip 与上传操作没有关系

isClose -》 renderClose

#### 结语

以上就是关于这本代码整洁之道的分享。其实写代码就是写小说，可能你的初稿比较粗糙杂乱，但是当再次精修的时候，需要注意调整那些复杂的部分，处理代码不合理的判断、循环等，分解函数，减少重复的代码逻辑，尽量让代码整洁舒适，有一个越来越好的开发体验。保持整洁的代码可能短时间内没有感觉有差别，但是从长远来看，对团队有非常好的帮助。






